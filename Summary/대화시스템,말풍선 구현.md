# 대화 시스템, 말풍선 구현

스토리 전개나 캐릭터간의 상호작용 기능이 필요한 경우  
말풍선과 대화시스템을 구현하는데, 이에 대해서 알아보았다.

## GameManager, TalkManager

빈 오브젝트에 게임 이벤트나 대화 이벤트를 담당하는 클래스를 만들고  
특정 조건에 맞으면 해당 클래스에서 작성된 함수를 호출하는 방식으로 구현하였다.


### 말풍선 On/Off

캐릭터와 상호작용을 진행할때에만 말풍선을 띄우기 위해  
말풍선을 On/Off 하는 기능을 구현하였다.

```C#
 public void Action(GameObject scanObj)
    {
        if (isAction)   //이미 상호작용 중인 경우 상호작용을 종료한다.
        {
            isAction = false;
        }
        else            //상호작용 중이 아닌 경우 상호작용을 시작한다.
        {
            isAction = true;

            scanObject = scanObj;
            ObjectData objData = scanObject.GetComponent<ObjectData>();
            Talk(objData.id, objData.isNpc);
        }

        talkPanel.SetActive(isAction); //isAction 상태에 따라 말풍선 On/Off

    }
```

    
  
### 말풍선 Text 내용

말풍선 안에 어떤 내용을 담을지 정하는것을 스크립트 만으로 구현하였다.

```C#
    scanObject = scanObj;
    ObjectData objData = scanObject.GetComponent<ObjectData>();
    Talk(objData.id, objData.isNpc);
```
* 상호작용할 오브젝트에 대한 정보를 받아오면 Talk함수를 호출한다.  
  
  

    
```C#
    void Talk(int id, bool isNpc)
    {
        string talkData = talkManager.GetTalk(id, talkIndex);
        talkText.text = talkData;
    }
```
* Talk 함수는 말풍선의 내용을 정한 후 바꿔주는 함수이다.  
* Talk 함수는 talkManager로부터 말풍선 내용으로 들어갈 string을 받아온다.  
  
  
  

```C#
public class TalkManager : MonoBehaviour
{
    Dictionary<int, string[]> talkData;

    void Awake()
    {
        talkData = new Dictionary<int, string[]>();
        GenerateData();
    }

    void GenerateData()
    {
        talkData.Add(1, new string[] { "안녕?", "안녕안녕 안녕??" });
        talkData.Add(2, new string[] { "좋은 날씨다." });
        talkData.Add(3, new string[] { "안좋은 날씨다." });
    }

    public string GetTalk(int id, int talkIndex)
    {
        return talkData[id][talkIndex];
    }
}
```
* TalkManger클래스는 말풍선 내용으로 들어갈 여러 string을 저장해 놓은 클래스이다.
* 이런 string들의 저장은 클래스(스크립트)가 아닌 다른방법으로도 구현할 수 있다.